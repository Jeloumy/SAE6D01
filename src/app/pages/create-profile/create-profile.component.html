<div class="flex flex-col justify-center align-middle">
  <form (ngSubmit)="createProfile()" #profileForm="ngForm" class="justify-center max-w-screen-md p-4 m-8 rounded-md form-control bg-slate-100 dark:bg-slate-700">
    <label class="label">
      <span class="label-text">Nom d'utilisateur</span>
    </label>
    <input type="text" [(ngModel)]="profile.username" name="username" placeholder="Nom d'utilisateur" required
      class="w-full input input-bordered" #username="ngModel">
    <div *ngIf="username.invalid && (username.dirty || username.touched)" class="text-red-500">
      Le nom d'utilisateur est requis.
    </div>

    <label class="label">
      <span class="label-text">Type d'handicap</span>
    </label>
    <input type="text" [(ngModel)]="profile.handicapList[0].handicap" name="handicapList" placeholder="Type d'handicap" required
      class="w-full input input-bordered" #handicapList="ngModel">
    <div *ngIf="handicapList.invalid && (handicapList.dirty || handicapList.touched)" class="text-red-500">
      Au moins 1 handicap est requis.
    </div>

    <button type="submit" class="w-full mt-6 btn btn-primary" type="submit" [disabled]="profileForm.invalid">Créer</button>
  </form>

  <div class="max-w-screen-md gap-4 p-4 m-8 rounded-md form-control bg-slate-100 dark:bg-slate-700">
    <div class="flex flex-grow gap-4" *ngFor="let profile of profilesList; let i = index"
         [ngClass]="{'text-blue-500': profile.username === currentProfile?.username}">
      <div class="flex items-center flex-grow gap-4">
        <p class="" (click)="selectProfile(profile, true)"><b>{{ profile.username }}</b></p>
        <p class="" (click)="selectProfile(profile, true)">
          {{ profile.handicapList && profile.handicapList.length ? profile.handicapList[0].handicap : 'N/A' }}
        </p>        
      </div>
      <div class="flex gap-4">
        <button class="btn btn-primary btn-square" (click)="editProfile(profile); $event.stopPropagation();">
          <i class="fas fa-edit"></i>
        </button>
        <button class="btn btn-error btn-square" (click)="deleteProfile(profile.id); $event.stopPropagation();">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </div>
    <div *ngIf="profilesList.length === 0 && currentProfile === null" class="alert alert-warning">
      <span><b>Aucun profil disponible.</b> <br> Veuillez créer un nouveau profil.</span>
    </div>
    <div *ngIf="profilesList.length > 0 && currentProfile === null" class="alert alert-warning">
      <span>Veuillez sélectionner un profil parmi les profils existants.</span>
    </div>
  </div>

  <div *ngIf="showModal">
    <app-profile-selector-dialog 
      [profilesList]="profilesList" 
      (selectionConfirmed)="onProfileSelected($event)">
    </app-profile-selector-dialog>
  </div>
</div>